{"version":3,"file":"BrockInserter.js","sources":["../../src/BrockInserter.js"],"sourcesContent":["import {\r\n  serializeBlockTree,\r\n  createBlockTree,\r\n  flattenBlocks,\r\n} from \"./blockStore\";\r\nimport { createBlock, getBlockType } from \"@wordpress/blocks\";\r\nimport { useEffect } from \"@wordpress/element\";\r\nimport { useSelect, useDispatch } from \"@wordpress/data\";\r\n\r\n//フィールド生成用関数\r\nconst createBlockAttr = (selectedField) => {\r\n  let blockAttributes = {};\r\n  switch (selectedField.block) {\r\n    case \"itmar/design-title\":\r\n      const block_class = selectedField.key.startsWith(\"tax_\")\r\n        ? selectedField.key\r\n        : `sp_field_${selectedField.key}`;\r\n      blockAttributes = {\r\n        className: block_class,\r\n        headingContent: `[${selectedField.label}]`,\r\n      };\r\n\r\n      break;\r\n    case \"core/paragraph\":\r\n      blockAttributes = {\r\n        className: `itmar_ex_block sp_field_${selectedField.key}`,\r\n        content: `[${selectedField.label}]`,\r\n      };\r\n      break;\r\n    case \"core/image\":\r\n      blockAttributes = {\r\n        className: `itmar_ex_block sp_field_${selectedField.key}`,\r\n        url: `${itmar_option.plugin_url}/assets/image/main_sample.png`,\r\n      };\r\n      break;\r\n    case \"itmar/slide-mv\":\r\n      const spaceAttributes = {\r\n        margin_val: {\r\n          type: \"object\",\r\n          default: {\r\n            top: \"0em\",\r\n            left: \"0em\",\r\n            bottom: \"0em\",\r\n            right: \"0em\",\r\n          },\r\n        },\r\n        padding_val: {\r\n          type: \"object\",\r\n          default: {\r\n            top: \"0em\",\r\n            left: \"0em\",\r\n            bottom: \"0em\",\r\n            right: \"0em\",\r\n          },\r\n        },\r\n      };\r\n\r\n      const imageBlock = createBlock(\"core/image\", {\r\n        className: \"itmar_ex_block\",\r\n        url: `${itmar_option.plugin_url}/assets/image/slide_sample.png`,\r\n        ...spaceAttributes,\r\n      });\r\n      //Design Blockの初期設定を取得\r\n      const blockType = getBlockType(\"itmar/design-group\");\r\n      const defaultValBase = blockType?.attributes?.default_val?.default ?? {};\r\n      const mobileValBase = blockType?.attributes?.mobile_val?.default ?? {};\r\n      const slideBlock = createBlock(\r\n        \"itmar/design-group\",\r\n        {\r\n          default_val: {\r\n            ...defaultValBase,\r\n            width_val: \"fit\",\r\n          },\r\n          mobile_val: {\r\n            ...mobileValBase,\r\n            width_val: \"fit\",\r\n          },\r\n        },\r\n        [imageBlock],\r\n      );\r\n      //slideBlock をシリアライズ\r\n      const serializedSlide = serializeBlockTree(slideBlock);\r\n      // 同じスライドブロックを5つ複製（独立したブロックとして）\r\n      const slideBlocks = Array.from({ length: 5 }, () =>\r\n        createBlockTree(serializedSlide),\r\n      );\r\n      //子ブロック付きで返す\r\n      blockAttributes = {\r\n        attributes: { className: `sp_field_${selectedField.key}` },\r\n        slideBlocks: slideBlocks,\r\n      };\r\n      break;\r\n    default:\r\n      blockAttributes = {\r\n        className: `sp_field_${selectedField.key}`,\r\n        headingContent: `[${selectedField.label}]`,\r\n      };\r\n  }\r\n  return blockAttributes;\r\n};\r\n\r\n//表示フィールド変更によるインナーブロックの再構成\r\nexport const useRebuildChangeField = (\r\n  dispAttributeArray,\r\n  selectedFields,\r\n  pickupType,\r\n  dispTaxonomies,\r\n  sectionCount,\r\n  domType,\r\n  clientId,\r\n  insertId,\r\n) => {\r\n  // dispatch関数を取得\r\n  const { replaceInnerBlocks } = useDispatch(\"core/block-editor\");\r\n  const pickupBlock = useSelect(\r\n    (select) => select(\"core/block-editor\").getBlock(clientId),\r\n    [clientId],\r\n  );\r\n\r\n  useEffect(() => {\r\n    //dispAttributeArray の個数調整\r\n    const blocksLength = dispAttributeArray.length;\r\n    if (blocksLength < sectionCount) {\r\n      // dispAttributeArrayの長さが短い場合、{}を追加する\r\n      const diff = sectionCount - blocksLength;\r\n      for (let i = 0; i < diff; i++) {\r\n        dispAttributeArray.push({});\r\n      }\r\n    } else {\r\n      // dispAttributeArrayの長さが長い場合、余分な要素を削除する\r\n      dispAttributeArray.splice(sectionCount);\r\n    }\r\n\r\n    // インナーブロックに差し込むブロック配列を生成\r\n    const blocksArray = dispAttributeArray.map((dispAttribute, unit_index) => {\r\n      // blocksAttributesArray属性で登録されたブロックのclassName一覧（sp_field_xxx を拾う）\r\n      const allBlocks = Array.isArray(dispAttribute.innerBlocks)\r\n        ? flattenBlocks(dispAttribute.innerBlocks) //階層になったブロックを平坦化\r\n        : [];\r\n\r\n      const existingKeys = allBlocks\r\n        .map((block) => block.attributes?.className)\r\n        .filter(Boolean)\r\n        .map((cls) => {\r\n          // sp_field_◯◯ か tax_◯◯ のどちらかにマッチ\r\n          const match = cls.match(/sp_field_([\\w-]+)|(tax_[\\w-]+)/);\r\n          if (!match) return null;\r\n\r\n          // match[1] があれば sp_field_ のほう → プレフィックス除去\r\n          // match[2] があれば tax_ のほう → そのまま返す\r\n          return match[1] ?? match[2];\r\n        })\r\n        .filter(Boolean);\r\n\r\n      // dispTaxonomies からオブジェクトを作って selectedFieldsに加えてnewSelectedFieldsを生成\r\n      const newSelectedFields = [\r\n        ...selectedFields,\r\n        ...dispTaxonomies.map((tax) => ({\r\n          key: `tax_${tax}`, // 例: \"tax_category\"\r\n          label: tax, // 例: \"category\"\r\n          block: \"itmar/design-title\",\r\n        })),\r\n      ];\r\n\r\n      //  newSelectedFieldsのうち未挿入のものだけ追加\r\n      const autoGeneratedBlocks = newSelectedFields\r\n        .filter((field) => !existingKeys.includes(field.key))\r\n        .map((field) => {\r\n          const attr = createBlockAttr(field);\r\n          const blockName = field.block;\r\n          const blockAttributes = attr?.attributes ?? attr;\r\n          const innerBlocks = Array.isArray(attr?.slideBlocks)\r\n            ? attr.slideBlocks\r\n            : [];\r\n\r\n          return createBlock(blockName, blockAttributes, innerBlocks);\r\n        });\r\n      // blocksAttributesArray属性で登録されたブロックの再構築\r\n      const selectedKeys = selectedFields.map((f) => f.key);\r\n\r\n      const filterBlocksRecursively = (blocks) => {\r\n        return blocks\r\n          .map((block) => {\r\n            const className = block.attributes?.className || \"\";\r\n            // 1. まず sp_field_ のパターンを探す\r\n            let match = className.match(/sp_field_([a-zA-Z0-9_]+)/);\r\n            // 2. 見つからなければ tax_○○ をチェック\r\n            if (className.startsWith(\"tax_\")) {\r\n              const name = className.slice(\"tax_\".length); // \"tax_category\" → \"category\"\r\n\r\n              // dispTaxonomies に含まれないものだけ有効とする\r\n              if (!dispTaxonomies.includes(name)) {\r\n                // 正規表現の match 結果っぽい形の配列を自分で作る\r\n                // [0] に全体一致, [1] にグループ1 というイメージ\r\n                match = [`tax_${name}`, name];\r\n              }\r\n            }\r\n\r\n            // 再帰的に innerBlocks をフィルタ\r\n            const filteredInner = block.innerBlocks\r\n              ? filterBlocksRecursively(block.innerBlocks)\r\n              : [];\r\n\r\n            const isAutoGenerated = !!match;\r\n            const keep = !isAutoGenerated || selectedKeys.includes(match[1]);\r\n\r\n            if (!keep) return null;\r\n\r\n            // 構造を復元して返す\r\n            return {\r\n              ...block,\r\n              innerBlocks: filteredInner,\r\n            };\r\n          })\r\n          .filter(Boolean); // null を除去\r\n      };\r\n\r\n      const userBlocks = Array.isArray(dispAttribute.innerBlocks)\r\n        ? filterBlocksRecursively(dispAttribute.innerBlocks).map(\r\n            createBlockTree,\r\n          )\r\n        : [];\r\n\r\n      // autoGenerated（selectedFields） + userBlocks を合成\r\n      const innerBlocks = [...userBlocks, ...autoGeneratedBlocks];\r\n\r\n      const ret = createBlock(\r\n        \"itmar/design-group\",\r\n        {\r\n          ...dispAttribute.attributes,\r\n          className: `unit_design_${unit_index}`,\r\n          domType: domType,\r\n        },\r\n        innerBlocks,\r\n      );\r\n\r\n      return ret;\r\n    });\r\n\r\n    //挿入するブロックと自身のブロックが異なる場合（slide-mvにデータを入れる場合）\r\n    if (insertId !== clientId) {\r\n      blocksArray.push(pickupBlock);\r\n    }\r\n    // 既存のインナーブロックを一括置換\r\n    replaceInnerBlocks(insertId, blocksArray, false);\r\n  }, [selectedFields, pickupType, dispTaxonomies]);\r\n};\r\n"],"names":["createBlockAttr","selectedField","_blockType$attributes","_blockType$attributes2","_blockType$attributes3","_blockType$attributes4","blockAttributes","block","block_class","key","startsWith","concat","className","headingContent","label","content","url","itmar_option","plugin_url","spaceAttributes","margin_val","type","default","top","left","bottom","right","padding_val","imageBlock","createBlock","_objectSpread","blockType","getBlockType","defaultValBase","attributes","default_val","mobileValBase","mobile_val","slideBlock","width_val","serializedSlide","serializeBlockTree","slideBlocks","Array","from","length","createBlockTree","useRebuildChangeField","dispAttributeArray","selectedFields","pickupType","dispTaxonomies","sectionCount","domType","clientId","insertId","replaceInnerBlocks","useDispatch","pickupBlock","useSelect","select","getBlock","useEffect","blocksLength","diff","i","push","splice","blocksArray","map","dispAttribute","unit_index","allBlocks","isArray","innerBlocks","flattenBlocks","existingKeys","_block$attributes","filter","Boolean","cls","_match$","match","newSelectedFields","tax","autoGeneratedBlocks","field","includes","_attr$attributes","attr","blockName","selectedKeys","f","filterBlocksRecursively","blocks","_block$attributes2","name","slice","filteredInner","isAutoGenerated","keep","userBlocks","ret"],"mappings":"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"}