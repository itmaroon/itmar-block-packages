{"version":3,"file":"mediaUpload.js","sources":["../../src/mediaUpload.js"],"sourcesContent":["import { MediaUpload, MediaUploadCheck } from \"@wordpress/block-editor\";\r\nimport { __ } from \"@wordpress/i18n\";\r\nimport { Button, PanelBody } from \"@wordpress/components\";\r\n\r\nexport function SingleImageSelect(props) {\r\n  const { attributes } = props;\r\n  const { mediaID, media } = attributes;\r\n\r\n  //URL の配列から画像を生成\r\n  const getImage = (image) => {\r\n    //メディアオブジェクトの配列をループ処理\r\n    return (\r\n      <figure>\r\n        <img src={image.url} className=\"image\" alt=\"アップロード画像\" />\r\n      </figure>\r\n    );\r\n  };\r\n\r\n  //メディアライブラリを開くボタンをレンダリングする関数\r\n  const getImageButton = (open) => {\r\n    if (media) {\r\n      return (\r\n        <div onClick={open} className=\"block-container\">\r\n          {getImage(media)}\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"button-container\">\r\n          <Button onClick={open} className=\"button button-large\">\r\n            {__(\"Sel\", \"itmar_mv_blocks\")}\r\n          </Button>\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <MediaUploadCheck>\r\n      <MediaUpload\r\n        onSelect={(media) => props.onSelectChange(media)}\r\n        allowedTypes={[\"image\"]}\r\n        value={mediaID}\r\n        render={({ open }) => getImageButton(open)}\r\n      />\r\n    </MediaUploadCheck>\r\n  );\r\n}\r\n\r\nexport function MultiImageSelect(props) {\r\n  const { attributes, label } = props;\r\n  const { mediaID, media } = attributes;\r\n\r\n  //URL の配列から画像を生成\r\n  const getImages = (media) => {\r\n    //メディアオブジェクトの配列をループ処理\r\n    let imagesArray = media.map((image, index) => {\r\n      return (\r\n        <figure key={index}>\r\n          <img src={image.url} className=\"image\" alt=\"アップロード画像\" />\r\n          <figcaption className=\"block-image-caption\">\r\n            {image.caption ? image.caption : \"\"}\r\n          </figcaption>\r\n        </figure>\r\n      );\r\n    });\r\n    return imagesArray;\r\n  };\r\n\r\n  //メディアライブラリを開くボタンをレンダリングする関数\r\n  const getImageButton = (open) => {\r\n    if (media.length > 0) {\r\n      return (\r\n        <div key=\"media-container\" onClick={open} className=\"block-container\">\r\n          {getImages(media)}\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div key=\"media-container\" className=\"button-container\">\r\n          <Button onClick={open} className=\"button button-large\">\r\n            {__(\"Image Upload\", \"slide-blocks\")}\r\n          </Button>\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <PanelBody title={label} initialOpen={true} className=\"itmar_image_display\">\r\n      <MediaUploadCheck>\r\n        <MediaUpload\r\n          multiple={true}\r\n          gallery={true} //追加\r\n          onSelect={(media) => props.onSelectChange(media)}\r\n          allowedTypes={[\"image\"]}\r\n          value={mediaID}\r\n          render={({ open }) => getImageButton(open)}\r\n        />\r\n      </MediaUploadCheck>\r\n      {media.length != 0 && ( //メディアオブジェクト（配列の長さ）で判定\r\n        <MediaUploadCheck>\r\n          <Button\r\n            onClick={() => props.onAllDelete()}\r\n            variant=\"secondary\"\r\n            isDestructive\r\n            className=\"removeImage\"\r\n          >\r\n            {__(\"Delete All\", \"slide-blocks\")}\r\n          </Button>\r\n        </MediaUploadCheck>\r\n      )}\r\n    </PanelBody>\r\n  );\r\n}\r\n\r\n//静止画か動画かを判定する関数\r\nexport function getMediaType(url) {\r\n  const imageExtensions = [\r\n    \".jpg\",\r\n    \".jpeg\",\r\n    \".png\",\r\n    \".gif\",\r\n    \".webp\",\r\n    \".bmp\",\r\n    \".svg\",\r\n  ];\r\n  const videoExtensions = [\".mp4\", \".webm\", \".ogg\", \".mov\", \".m4v\"];\r\n\r\n  // クエリストリング（?以降）を除去\r\n  const cleanUrl = url.split(\"?\")[0].toLowerCase();\r\n\r\n  const isImage = imageExtensions.some((ext) => cleanUrl.endsWith(ext));\r\n  const isVideo = videoExtensions.some((ext) => cleanUrl.endsWith(ext));\r\n\r\n  if (isImage) {\r\n    return \"image\";\r\n  } else if (isVideo) {\r\n    return \"video\";\r\n  } else {\r\n    // 拡張子で判別できない → HEADリクエストでContent-Type判定 or fallback\r\n    return undefined;\r\n  }\r\n}\r\n//静止画のアスペクト比を返す関数\r\nexport function getImageAspectRatio(url) {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image();\r\n    img.onload = function () {\r\n      const aspectRatio = img.naturalWidth / img.naturalHeight;\r\n      resolve(aspectRatio);\r\n    };\r\n    img.onerror = function () {\r\n      reject(new Error(\"画像の読み込みに失敗しました: \" + url));\r\n    };\r\n    img.src = url;\r\n  });\r\n}\r\n//動画のアスペクト比を返す関数\r\nexport function getVideoAspectRatio(url) {\r\n  return new Promise((resolve, reject) => {\r\n    const video = document.createElement(\"video\");\r\n\r\n    video.preload = \"metadata\";\r\n    video.src = url;\r\n    video.muted = true; // 一部のブラウザで安全に動作させるため\r\n    video.playsInline = true;\r\n\r\n    video.onloadedmetadata = function () {\r\n      const aspectRatio = video.videoWidth / video.videoHeight;\r\n      resolve(aspectRatio);\r\n    };\r\n\r\n    video.onerror = function () {\r\n      reject(new Error(\"動画の読み込みに失敗しました: \" + url));\r\n    };\r\n  });\r\n}\r\n"],"names":["SingleImageSelect","props","attributes","mediaID","media","getImage","image","React","createElement","src","url","className","alt","getImageButton","open","onClick","Button","__","MediaUploadCheck","MediaUpload","onSelect","onSelectChange","allowedTypes","value","render","_ref","MultiImageSelect","label","getImages","imagesArray","map","index","key","caption","length","PanelBody","title","initialOpen","multiple","gallery","_ref2","onAllDelete","variant","isDestructive","getMediaType","imageExtensions","videoExtensions","cleanUrl","split","toLowerCase","isImage","some","ext","endsWith","isVideo","undefined","getImageAspectRatio","Promise","resolve","reject","img","Image","onload","aspectRatio","naturalWidth","naturalHeight","onerror","Error","getVideoAspectRatio","video","document","preload","muted","playsInline","onloadedmetadata","videoWidth","videoHeight"],"mappings":"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"}