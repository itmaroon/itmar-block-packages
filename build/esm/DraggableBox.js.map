{"version":3,"file":"DraggableBox.js","sources":["../../src/DraggableBox.js"],"sourcesContent":["import { __ } from \"@wordpress/i18n\";\n\nimport {\n  Button,\n  PanelBody,\n  PanelRow,\n  __experimentalUnitControl as UnitControl,\n} from \"@wordpress/components\";\n\nimport { useEffect, useRef } from \"@wordpress/element\";\n\nexport const useDraggingMove = (\n  isMovable,\n  blockRef,\n  position,\n  onPositionChange\n) => {\n  const elmposition = useRef({ x: 0, y: 0 });\n  const isDragging = useRef(false);\n  const mousePosition = useRef({ x: 0, y: 0 });\n\n  useEffect(() => {\n    const element = blockRef.current;\n\n    if (!isMovable) {\n      if (element) {\n        element.classList.remove(\"itmar_isDraggable\"); //移動カーソル表示クラス削除\n      }\n      return; // 移動許可がある場合のみ、後続のロジックを実行\n    }\n    //positionの変化に合わせて現在位置を変更\n    const pos_value_x = position.x.match(/(-?\\d+)([%a-zA-Z]+)/);\n    const pos_value_y = position.y.match(/(-?\\d+)([%a-zA-Z]+)/);\n    elmposition.current = {\n      x: parseInt(pos_value_x[1]),\n      y: parseInt(pos_value_y[1]),\n    };\n\n    //イベントハンドラ\n    const handleMouseDown = (event) => {\n      // 移動カーソル表示クラス名を追加します。\n      element.classList.add(\"itmar_isDraggable\");\n      //ドラッグの開始フラグオン\n      isDragging.current = true;\n      //ドラッグ開始の絶対位置\n      mousePosition.current = { x: event.clientX, y: event.clientY };\n    };\n\n    const handleMouseMove = (event) => {\n      if (!isDragging.current) return; //ドラッグ中でなければ処理を中止\n      const dx = event.clientX - mousePosition.current.x;\n      const dy = event.clientY - mousePosition.current.y;\n      //ドラッグ後の位置を保存\n      const newPosition = {\n        x: elmposition.current.x + dx,\n        y: elmposition.current.y + dy,\n      };\n      elmposition.current = newPosition;\n      mousePosition.current = { x: event.clientX, y: event.clientY }; //マウス位置の保存\n      //ドラッグによるブロックの一時的移動\n      element.style.transform = `translate(${elmposition.current.x}px, ${elmposition.current.y}px)`;\n    };\n\n    const handleMouseUp = () => {\n      isDragging.current = false;\n      element.style.transform = null;\n      //呼出しもとに要素の位置を返す\n      onPositionChange({\n        x: `${elmposition.current.x}px`,\n        y: `${elmposition.current.y}px`,\n      });\n    };\n    const handleMouseLeave = () => {\n      isDragging.current = false;\n    };\n\n    if (element) {\n      // クラス名を追加します。\n      element.classList.add(\"itmar_isDraggable\");\n    }\n    // イベントハンドラを追加します。\n    element.addEventListener(\"mousedown\", handleMouseDown);\n    element.addEventListener(\"mousemove\", handleMouseMove);\n    element.addEventListener(\"mouseup\", handleMouseUp);\n    element.addEventListener(\"mouseleave\", handleMouseLeave);\n\n    // イベントリスナーを削除するクリーンアップ関数を返します。\n    return () => {\n      element.removeEventListener(\"mousedown\", handleMouseDown);\n      element.removeEventListener(\"mousemove\", handleMouseMove);\n      element.removeEventListener(\"mouseup\", handleMouseUp);\n      element.removeEventListener(\"mouseleave\", handleMouseLeave);\n      element.style.transform = null;\n    };\n  }, [isMovable, blockRef, position, onPositionChange]); // 依存配列に isMovable を含めます\n};\n\nexport default function DraggableBox(props) {\n  const position = props.attributes;\n\n  //インスペクター内のコントロールからの移動操作\n  const chagePosition = (value, cordinate) => {\n    if (value) {\n      const newPos = { ...position, [cordinate]: value };\n      props.onPositionChange(newPos);\n    }\n  };\n\n  //リセット\n  const resetPos = () => {\n    const newPos = { x: \"0px\", y: \"0px\" };\n    props.onPositionChange(newPos);\n  };\n\n  return (\n    <>\n      <PanelBody\n        title={__(\"Position Setting\", \"block-collections\")}\n        initialOpen={true}\n      >\n        <PanelRow className=\"distance_row\">\n          <UnitControl\n            dragDirection=\"e\"\n            onChange={(value) => chagePosition(value, \"x\")}\n            label={__(\"Vertical\", \"block-collections\")}\n            value={position?.x || 0}\n          />\n          <UnitControl\n            dragDirection=\"e\"\n            onChange={(value) => chagePosition(value, \"y\")}\n            label={__(\"Horizen\", \"block-collections\")}\n            value={position?.y || 0}\n          />\n        </PanelRow>\n        <PanelRow className=\"reset_row\">\n          <Button variant=\"secondary\" onClick={() => resetPos()}>\n            {__(\"Reset\", \"block-collections\")}\n          </Button>\n        </PanelRow>\n      </PanelBody>\n    </>\n  );\n}\n"],"names":["useDraggingMove","isMovable","blockRef","position","onPositionChange","elmposition","useRef","x","y","isDragging","mousePosition","useEffect","element","current","classList","remove","pos_value_x","match","pos_value_y","parseInt","handleMouseDown","event","add","clientX","clientY","handleMouseMove","dx","dy","newPosition","style","transform","concat","handleMouseUp","handleMouseLeave","addEventListener","removeEventListener","DraggableBox","props","attributes","chagePosition","value","cordinate","newPos","_objectSpread","resetPos","React","createElement","Fragment","PanelBody","title","__","initialOpen","PanelRow","className","UnitControl","dragDirection","onChange","label","Button","variant","onClick"],"mappings":"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"}