{"version":3,"file":"formatCreate.js","sources":["../../src/formatCreate.js"],"sourcesContent":["import { __ } from \"@wordpress/i18n\";\r\nimport {\r\n  PanelBody,\r\n  PanelRow,\r\n  RangeControl,\r\n  TextControl,\r\n  SelectControl,\r\n} from \"@wordpress/components\";\r\nimport { format, getSettings } from \"@wordpress/date\";\r\n\r\n//日付のフォーマット\r\nconst dateFormats = [\r\n  { label: \"YYYY-MM-DD HH:mm:ss\", value: \"Y-m-d H:i:s\" },\r\n  { label: \"MM/DD/YYYY\", value: \"m/d/Y\" },\r\n  { label: \"DD/MM/YYYY\", value: \"d/m/Y\" },\r\n  { label: \"MMMM D, YYYY\", value: \"F j, Y\" },\r\n  { label: \"HH:mm:ss\", value: \"H:i:s\" },\r\n  { label: \"YYYY.M.D\", value: \"Y.n.j\" },\r\n  { label: \"Day, MMMM D, YYYY\", value: \"l, F j, Y\" },\r\n  { label: \"ddd, MMM D, YYYY\", value: \"D, M j, Y\" },\r\n  { label: \"YYYY年M月D日 (曜日)\", value: \"Y年n月j日 (l)\" },\r\n];\r\n//プレーンのフォーマット\r\nconst plaineFormats = [\r\n  {\r\n    key: \"str_free\",\r\n    label: __(\"Free String\", \"block-collections\"),\r\n    value: \"%s\",\r\n  },\r\n  {\r\n    key: \"num_comma\",\r\n    label: __(\"Numbers (comma separated)\", \"block-collections\"),\r\n    value: {\r\n      style: \"decimal\",\r\n      useGrouping: true, // カンマ区切り\r\n    },\r\n  },\r\n  {\r\n    key: \"num_no_comma\",\r\n    label: __(\"Numbers (no commas)\", \"block-collections\"),\r\n    value: {\r\n      style: \"decimal\",\r\n      useGrouping: false,\r\n    },\r\n  },\r\n  {\r\n    key: \"num_amount\",\r\n    label: __(\"Amount\", \"block-collections\"),\r\n    value: {\r\n      style: \"currency\",\r\n      currency: \"JPY\",\r\n    },\r\n  },\r\n];\r\n\r\nexport const FormatSelectControl = ({\r\n  titleType,\r\n  userFormat,\r\n  freeStrFormat,\r\n  decimal,\r\n  onFormatChange,\r\n}) => {\r\n  const isPlaine = titleType === \"plaine\";\r\n  const isDate = titleType === \"date\";\r\n  const isUser = titleType === \"user\";\r\n\r\n  //SelectControlのオプションを生成\r\n  const options = isDate\r\n    ? dateFormats\r\n    : plaineFormats.map((f) => ({ label: f.label, value: f.key }));\r\n\r\n  return (\r\n    <PanelBody title={__(\"Display Format Setting\", \"block-collections\")}>\r\n      {(isPlaine || isDate) && (\r\n        <>\r\n          <SelectControl\r\n            label={__(\"Select Format\", \"block-collections\")}\r\n            value={userFormat}\r\n            options={options}\r\n            onChange={(newFormat) =>\r\n              onFormatChange({\r\n                userFormat: newFormat,\r\n                freeStrFormat,\r\n                decimal,\r\n              })\r\n            }\r\n          />\r\n\r\n          {userFormat?.startsWith(\"str_\") && (\r\n            <TextControl\r\n              label={__(\"String Format\", \"block-collections\")}\r\n              value={freeStrFormat}\r\n              onChange={(newFormat) =>\r\n                onFormatChange({\r\n                  userFormat,\r\n                  freeStrFormat: newFormat,\r\n                  decimal,\r\n                })\r\n              }\r\n            />\r\n          )}\r\n          {userFormat?.startsWith(\"num_\") && (\r\n            <PanelRow className=\"itmar_post_blocks_pannel\">\r\n              <RangeControl\r\n                value={decimal}\r\n                label={__(\"Decimal Num\", \"query-blocks\")}\r\n                max={5}\r\n                min={0}\r\n                onChange={(val) =>\r\n                  onFormatChange({\r\n                    userFormat,\r\n                    freeStrFormat,\r\n                    decimal: val,\r\n                  })\r\n                }\r\n              />\r\n            </PanelRow>\r\n          )}\r\n        </>\r\n      )}\r\n\r\n      {isUser && (\r\n        <TextControl\r\n          label={__(\"User Format\", \"block-collections\")}\r\n          value={freeStrFormat}\r\n          onChange={(newFormat) =>\r\n            onFormatChange({\r\n              userFormat: \"str_free\",\r\n              freeStrFormat: newFormat,\r\n              decimal,\r\n            })\r\n          }\r\n        />\r\n      )}\r\n    </PanelBody>\r\n  );\r\n};\r\n\r\nexport const displayFormated = (\r\n  content,\r\n  userFormat,\r\n  freeStrFormat,\r\n  decimal\r\n) => {\r\n  // 内部で使用するロケール\r\n  const locale = getSettings().l10n?.locale || \"en\";\r\n\r\n  //日付にフォーマットがあれば、それで書式設定してリターン\r\n  const isDateFormat = dateFormats.find((f) => f.value === userFormat);\r\n  if (isDateFormat) {\r\n    const ret_val = format(userFormat, content, getSettings());\r\n    return ret_val;\r\n  }\r\n  //数値や文字列のフォーマット\r\n  const selectedFormat = plaineFormats.find((f) => f.key === userFormat)?.value;\r\n  if (typeof selectedFormat === \"object\") {\r\n    // Intl.NumberFormat オプション\r\n    try {\r\n      const numeric = parseFloat(content);\r\n      // `selectedFormat` を元に新しいフォーマット設定を生成（mutateしない）\r\n      const options = { ...selectedFormat };\r\n\r\n      if (typeof decimal === \"number\" && decimal > 0) {\r\n        options.minimumFractionDigits = decimal;\r\n        options.maximumFractionDigits = decimal;\r\n      }\r\n\r\n      const formatter = new Intl.NumberFormat(locale, options);\r\n      return formatter.format(numeric);\r\n    } catch (e) {\r\n      console.warn(\"Number format failed:\", e);\r\n      return content;\r\n    }\r\n  } else if (typeof selectedFormat === \"string\") {\r\n    return freeStrFormat.replace(\"%s\", content);\r\n  }\r\n  //フォーマットが見つからないときはそのまま返す\r\n  return content;\r\n};\r\n"],"names":["dateFormats","label","value","plaineFormats","key","__","style","useGrouping","currency","FormatSelectControl","_ref","titleType","userFormat","freeStrFormat","decimal","onFormatChange","isPlaine","isDate","isUser","options","map","f","React","createElement","PanelBody","title","Fragment","SelectControl","onChange","newFormat","startsWith","TextControl","PanelRow","className","RangeControl","max","min","val","displayFormated","content","_getSettings$l10n","_plaineFormats$find","locale","getSettings","l10n","isDateFormat","find","ret_val","format","selectedFormat","numeric","parseFloat","_objectSpread","minimumFractionDigits","maximumFractionDigits","formatter","Intl","NumberFormat","e","console","warn","replace"],"mappings":"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"}