{"version":3,"file":"wordpressApi.js","sources":["../../src/wordpressApi.js"],"sourcesContent":["import { useState, useEffect } from \"@wordpress/element\";\r\nimport { __ } from \"@wordpress/i18n\";\r\nimport {\r\n  ComboboxControl,\r\n  CheckboxControl,\r\n  ToggleControl,\r\n} from \"@wordpress/components\";\r\nimport apiFetch from \"@wordpress/api-fetch\";\r\nimport { addQueryArgs } from \"@wordpress/url\";\r\n\r\n//const _ = require(\"lodash\");\r\n\r\nexport const restFetchData = async (path) => {\r\n  try {\r\n    const ret_data = await apiFetch({ path: path });\r\n    return ret_data;\r\n  } catch (error) {\r\n    console.error(\"Error fetching data:\", error.message);\r\n  }\r\n};\r\n\r\n//コンボボックスコントロールのレンダリング関数\r\nconst SelectControl = (props) => {\r\n  const { selectedSlug, label, homeUrl, fetchOptions } = props;\r\n  const [options, setOptions] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const fetchedOptions = await fetchOptions(homeUrl, props);\r\n        setOptions(fetchedOptions);\r\n      } catch (error) {\r\n        console.error(\"Error fetching data:\", error.message);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [\r\n    fetchOptions,\r\n    homeUrl,\r\n    props.restBase,\r\n    props.status,\r\n    props.perPage,\r\n    props.orderby,\r\n    props.order,\r\n    props.search,\r\n  ]);\r\n\r\n  const selectedInfo = options.find((info) => info.slug === selectedSlug);\r\n  return (\r\n    <ComboboxControl\r\n      label={label}\r\n      options={options}\r\n      value={selectedInfo ? selectedInfo.value : -1}\r\n      onChange={(newValue) => {\r\n        const newInfo = options.find((info) => info.value === newValue);\r\n        props.onChange(newInfo);\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\n//選択コントロールのレンダリング関数\r\nconst ChoiceControl = (props) => {\r\n  const {\r\n    selectedSlug,\r\n    choiceItems,\r\n    dispTaxonomies,\r\n    type,\r\n    blockMap,\r\n    textDomain,\r\n    fetchFunction,\r\n  } = props;\r\n\r\n  const [choices, setChoices] = useState([]);\r\n  useEffect(() => {\r\n    if (!selectedSlug) return; //ポストタイプのスラッグが選択されていないときは処理終了\r\n    const fetchData = async () => {\r\n      try {\r\n        const fetchChoices = await fetchFunction(selectedSlug);\r\n        setChoices(fetchChoices);\r\n        //指定の投稿タイプに含まれないフィールドを削除する\r\n        pruneChoiceItemsByObjectKeys(fetchChoices[0], choiceItems);\r\n      } catch (error) {\r\n        console.error(\"Error fetching data:\", error.message);\r\n      }\r\n    };\r\n    fetchData();\r\n  }, [selectedSlug, fetchFunction]);\r\n\r\n  //選択肢が変わったときに選択されている項目の配列内容を更新するハンドラ\r\n  const handleChoiceChange = (checked, target, setItems) => {\r\n    if (checked) {\r\n      // targetが重複していない場合のみ追加\r\n      if (!setItems.some((item) => _.isEqual(item, target))) {\r\n        return [...setItems, target];\r\n      }\r\n    } else {\r\n      // targetを配列から削除\r\n      return setItems.filter((item) => !_.isEqual(item, target));\r\n    }\r\n    return setItems;\r\n  };\r\n  /**\r\n   * dataObj のキー一覧を「choiceItems と比較する形」に変換して Set で返す\r\n   * - 通常キー: そのまま\r\n   * - acf / meta: 子キーに `${parent}_` を付けたもの（例: acf_relate_url, meta_footnotes）\r\n   */\r\n  function buildComparableKeySet(dataObj) {\r\n    const keySet = new Set();\r\n\r\n    if (!dataObj || typeof dataObj !== \"object\") return keySet;\r\n\r\n    for (const [key, val] of Object.entries(dataObj)) {\r\n      if (\r\n        (key === \"acf\" || key === \"meta\") &&\r\n        val &&\r\n        typeof val === \"object\" &&\r\n        !Array.isArray(val)\r\n      ) {\r\n        for (const childKey of Object.keys(val)) {\r\n          keySet.add(`${key}_${childKey}`);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      keySet.add(key);\r\n    }\r\n\r\n    return keySet;\r\n  }\r\n\r\n  /**\r\n   * choiceItems を dataObj のキーに合わせて削除する\r\n   * - choiceItems が string 配列でも、{value: \"...\"} の配列でも動くようにしてあります\r\n   */\r\n  function pruneChoiceItemsByObjectKeys(dataObj, choiceItems) {\r\n    const validKeys = buildComparableKeySet(dataObj);\r\n\r\n    const getItemKey = (item) => {\r\n      if (typeof item === \"string\") return item;\r\n      if (item && typeof item === \"object\")\r\n        return item.value ?? item.key ?? item.name ?? \"\";\r\n      return \"\";\r\n    };\r\n\r\n    const next = (choiceItems ?? []).filter((item) =>\r\n      validKeys.has(getItemKey(item))\r\n    );\r\n\r\n    // ★ 配列の参照はそのまま、中身だけ置き換える\r\n    choiceItems.splice(0, choiceItems.length, ...next);\r\n\r\n    return choiceItems; // 必要なら返す\r\n  }\r\n\r\n  //階層化されたカスタムフィールドのフィールド名を表示する関数\r\n  let groupLabel = \"\";\r\n  const dispCustumFields = (obj, prefix = \"\", isImage = false, onChange) => {\r\n    return Object.entries(obj).map(([key, value]) => {\r\n      const fieldName = prefix ? `${prefix}.${key}` : key; //prefixはグループ名\r\n\r\n      const fieldLabel = key.replace(/^(meta_|acf_)/, \"\");\r\n      //オブジェクトであって配列でないものがグループと考える\r\n      if (\r\n        typeof value === \"object\" &&\r\n        !Array.isArray(value) &&\r\n        value !== null\r\n      ) {\r\n        groupLabel = `${fieldLabel}.`;\r\n        return (\r\n          <div className=\"group_area\">\r\n            <div className=\"group_label\">{fieldLabel}</div>\r\n            <div key={fieldName} className=\"field_group\">\r\n              {dispCustumFields(value, fieldName, isImage, onChange)}\r\n            </div>\r\n          </div>\r\n        );\r\n      } else {\r\n        if (key === \"meta__acf_changed\" || key === \"meta_footnotes\") return; //_acf_changedは対象外\r\n\r\n        //フィールドを表示するブロックの選択肢\r\n        const options = [\r\n          { value: \"itmar/design-title\", label: \"itmar/design-title\" },\r\n          { value: \"core/paragraph\", label: \"core/paragraph\" },\r\n          { value: \"core/image\", label: \"core/image\" },\r\n          { value: \"itmar/slide-mv\", label: \"itmar/slide-mv\" },\r\n        ];\r\n        return (\r\n          <div className=\"itmar_custom_field_set\">\r\n            <ToggleControl\r\n              key={fieldName}\r\n              className=\"field_choice\"\r\n              label={fieldLabel}\r\n              checked={choiceItems.some(\r\n                (choiceField) => choiceField === fieldName\r\n              )}\r\n              onChange={(checked) => {\r\n                const newChoiceFields = handleChoiceChange(\r\n                  checked,\r\n                  fieldName,\r\n                  choiceItems\r\n                );\r\n                props.onChange(newChoiceFields);\r\n              }}\r\n            />\r\n            {!isImage && (\r\n              <ComboboxControl\r\n                options={options}\r\n                value={\r\n                  //blockMap[`${prefix ? groupLabel : \"\"}${key}`] || \"itmar/design-title\"\r\n                  blockMap[`${prefix ? prefix + \".\" : \"\"}${key}`] ||\r\n                  \"itmar/design-title\"\r\n                }\r\n                onChange={(newValue) => {\r\n                  //const fieldKey = prefix ? `${groupLabel}${key}` : `${key}`;\r\n                  const fieldKey = prefix ? `${prefix}.${key}` : `${key}`;\r\n\r\n                  const newBlockMap = { ...blockMap, [fieldKey]: newValue };\r\n                  props.onBlockMapChange(newBlockMap);\r\n                }}\r\n              />\r\n            )}\r\n          </div>\r\n        );\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className={`${type}_section`}>\r\n      {type === \"taxonomy\" &&\r\n        choices.map((choice, index) => {\r\n          return (\r\n            <div key={index} className=\"term_section\">\r\n              <div className=\"tax_label\">\r\n                {choice.name}\r\n                <ToggleControl\r\n                  label={__(\"Display\", \"block-collections\")}\r\n                  checked={dispTaxonomies.some((tax) => tax === choice.slug)}\r\n                  onChange={(checked) => {\r\n                    const newChoiceFields = handleChoiceChange(\r\n                      checked,\r\n                      choice.slug,\r\n                      dispTaxonomies\r\n                    );\r\n                    props.onSetDispTax(newChoiceFields);\r\n                  }}\r\n                />\r\n              </div>\r\n              {choice.terms.map((term, index) => {\r\n                return (\r\n                  <CheckboxControl\r\n                    className=\"term_check\"\r\n                    key={index}\r\n                    label={term.name}\r\n                    checked={choiceItems.some((choiceTerm) => {\r\n                      return (\r\n                        choiceTerm.taxonomy === choice.slug &&\r\n                        choiceTerm.term.id === term.id\r\n                      );\r\n                    })}\r\n                    onChange={(checked) => {\r\n                      const target = {\r\n                        taxonomy: choice.slug,\r\n                        term: { id: term.id, slug: term.slug, name: term.name },\r\n                      };\r\n                      const newChoiceTerms = handleChoiceChange(\r\n                        checked,\r\n                        target,\r\n                        choiceItems\r\n                      );\r\n                      props.onChange(newChoiceTerms);\r\n                    }}\r\n                  />\r\n                );\r\n              })}\r\n            </div>\r\n          );\r\n        })}\r\n      {type === \"field\" &&\r\n        choices.map((choice, index) => {\r\n          //metaの対象カスタムフィールドが含まれるかのフラグ\r\n          const metaFlg =\r\n            choice.meta &&\r\n            !Object.keys(choice.meta).every(\r\n              (key) => key === \"_acf_changed\" || key === \"footnotes\"\r\n            );\r\n          //acfの対象カスタムフィールドが含まれるかのフラグ\r\n          const acfFlg =\r\n            choice.acf &&\r\n            typeof choice.acf === \"object\" &&\r\n            !Array.isArray(choice.acf);\r\n\r\n          return (\r\n            <div key={index} className=\"field_section\">\r\n              {choice.title && (\r\n                <ToggleControl\r\n                  className=\"field_choice\"\r\n                  label={__(\"Title\", \"block-collections\")}\r\n                  checked={choiceItems.some(\r\n                    (choiceField) => choiceField === \"title\"\r\n                  )}\r\n                  onChange={(checked) => {\r\n                    const newChoiceFields = handleChoiceChange(\r\n                      checked,\r\n                      \"title\",\r\n                      choiceItems\r\n                    );\r\n                    props.onChange(newChoiceFields);\r\n                  }}\r\n                />\r\n              )}\r\n              {choice.content && (\r\n                <ToggleControl\r\n                  className=\"field_choice\"\r\n                  label={__(\"Content\", \"block-collections\")}\r\n                  checked={choiceItems.some(\r\n                    (choiceField) => choiceField === \"content\"\r\n                  )}\r\n                  onChange={(checked) => {\r\n                    const newChoiceFields = handleChoiceChange(\r\n                      checked,\r\n                      \"content\",\r\n                      choiceItems\r\n                    );\r\n                    props.onChange(newChoiceFields);\r\n                  }}\r\n                />\r\n              )}\r\n              {choice.date && (\r\n                <ToggleControl\r\n                  className=\"field_choice\"\r\n                  label={__(\"Date\", \"block-collections\")}\r\n                  checked={choiceItems.some(\r\n                    (choiceField) => choiceField === \"date\"\r\n                  )}\r\n                  onChange={(checked) => {\r\n                    const newChoiceFields = handleChoiceChange(\r\n                      checked,\r\n                      \"date\",\r\n                      choiceItems\r\n                    );\r\n                    props.onChange(newChoiceFields);\r\n                  }}\r\n                />\r\n              )}\r\n              {choice.excerpt && (\r\n                <ToggleControl\r\n                  className=\"field_choice\"\r\n                  label={__(\"Excerpt\", \"block-collections\")}\r\n                  checked={choiceItems.some(\r\n                    (choiceField) => choiceField === \"excerpt\"\r\n                  )}\r\n                  onChange={(checked) => {\r\n                    const newChoiceFields = handleChoiceChange(\r\n                      checked,\r\n                      \"excerpt\",\r\n                      choiceItems\r\n                    );\r\n                    props.onChange(newChoiceFields);\r\n                  }}\r\n                />\r\n              )}\r\n              {(choice.featured_media || choice.featured_media === 0) && (\r\n                <ToggleControl\r\n                  className=\"field_choice\"\r\n                  label={__(\"Featured Image\", \"block-collections\")}\r\n                  checked={choiceItems.some(\r\n                    (choiceField) => choiceField === \"featured_media\"\r\n                  )}\r\n                  onChange={(checked) => {\r\n                    const newChoiceFields = handleChoiceChange(\r\n                      checked,\r\n                      \"featured_media\",\r\n                      choiceItems\r\n                    );\r\n                    props.onChange(newChoiceFields);\r\n                  }}\r\n                />\r\n              )}\r\n              {choice.link && (\r\n                <div className=\"itmar_custom_field_set\">\r\n                  <ToggleControl\r\n                    className=\"field_choice\"\r\n                    label={__(\"Single Page Link\", \"block-collections\")}\r\n                    checked={choiceItems.some(\r\n                      (choiceField) => choiceField === \"link\"\r\n                    )}\r\n                    onChange={(checked) => {\r\n                      const newChoiceFields = handleChoiceChange(\r\n                        checked,\r\n                        \"link\",\r\n                        choiceItems\r\n                      );\r\n                      props.onChange(newChoiceFields);\r\n                    }}\r\n                  />\r\n                  <ComboboxControl\r\n                    options={[\r\n                      {\r\n                        value: \"itmar/design-button\",\r\n                        label: \"itmar/design-button\",\r\n                      },\r\n                      {\r\n                        value: \"itmar/design-title\",\r\n                        label: \"itmar/design-title\",\r\n                      },\r\n                    ]}\r\n                    value={blockMap[\"link\"]}\r\n                    onChange={(newValue) => {\r\n                      const newBlockMap = {\r\n                        ...blockMap,\r\n                        link: newValue,\r\n                      };\r\n                      props.onBlockMapChange(newBlockMap);\r\n                    }}\r\n                  />\r\n                  <p>\r\n                    {__(\r\n                      \"If no block is specified, a link will be set to the parent block, Design Group.\",\r\n                      \"block-collections\"\r\n                    )}\r\n                  </p>\r\n                </div>\r\n              )}\r\n              {(metaFlg || acfFlg) && (\r\n                <>\r\n                  <div className=\"custom_field_label\">\r\n                    {__(\"Custom Field\", \"block-collections\")}\r\n                  </div>\r\n                  <div className=\"custom_field_area\">\r\n                    {dispCustumFields({\r\n                      // meta はそのまま\r\n                      ...Object.entries(choice.meta).reduce(\r\n                        (acc, [key, value]) => ({\r\n                          ...acc,\r\n                          [`meta_${key}`]: value,\r\n                        }),\r\n                        {}\r\n                      ),\r\n                      // acf は「同名で _source があるもののベース側を除く」\r\n                      ...Object.entries(choice.acf)\r\n                        .filter(([key]) => !key.endsWith(\"_source\"))\r\n                        .reduce(\r\n                          (acc, [key, value]) => ({\r\n                            ...acc,\r\n                            [`acf_${key}`]: value,\r\n                          }),\r\n                          {}\r\n                        ),\r\n                    })}\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n      {type === \"imgField\" &&\r\n        choices.map((choice, index) => {\r\n          //metaの対象カスタムフィールドが含まれるかのフラグ\r\n          const metaFlg =\r\n            choice.meta &&\r\n            !Object.keys(choice.meta).every(\r\n              (key) => key === \"_acf_changed\" || key === \"footnotes\"\r\n            );\r\n          //acfの対象カスタムフィールドが含まれるかのフラグ\r\n          const acfFlg =\r\n            choice.acf &&\r\n            typeof choice.acf === \"object\" &&\r\n            !Array.isArray(choice.acf);\r\n\r\n          return (\r\n            <div key={index} className=\"field_section\">\r\n              {choice.content && (\r\n                <ToggleControl\r\n                  className=\"field_choice\"\r\n                  label={__(\"Content\", \"block-collections\")}\r\n                  checked={choiceItems.some(\r\n                    (choiceField) => choiceField === \"content\"\r\n                  )}\r\n                  onChange={(checked) => {\r\n                    const newChoiceFields = handleChoiceChange(\r\n                      checked,\r\n                      \"content\",\r\n                      choiceItems\r\n                    );\r\n                    props.onChange(newChoiceFields);\r\n                  }}\r\n                />\r\n              )}\r\n              {(choice.featured_media || choice.featured_media === 0) && (\r\n                <ToggleControl\r\n                  className=\"field_choice\"\r\n                  label={__(\"Featured Image\", \"block-collections\")}\r\n                  checked={choiceItems.some(\r\n                    (choiceField) => choiceField === \"featured_media\"\r\n                  )}\r\n                  onChange={(checked) => {\r\n                    const newChoiceFields = handleChoiceChange(\r\n                      checked,\r\n                      \"featured_media\",\r\n                      choiceItems\r\n                    );\r\n                    props.onChange(newChoiceFields);\r\n                  }}\r\n                />\r\n              )}\r\n\r\n              {(metaFlg || acfFlg) && (\r\n                <>\r\n                  <div className=\"custom_field_label\">\r\n                    {__(\"Custom Field\", \"block-collections\")}\r\n                  </div>\r\n                  <div className=\"custom_field_area\">\r\n                    {dispCustumFields(\r\n                      {\r\n                        // meta はそのまま\r\n                        ...Object.entries(choice.meta).reduce(\r\n                          (acc, [key, value]) => ({\r\n                            ...acc,\r\n                            [`meta_${key}`]: value,\r\n                          }),\r\n                          {}\r\n                        ),\r\n                        // acf は「同名で _source があるもののベース側を除く」\r\n                        ...Object.entries(choice.acf)\r\n                          .filter(([key]) => !key.endsWith(\"_source\"))\r\n                          .reduce(\r\n                            (acc, [key, value]) => ({\r\n                              ...acc,\r\n                              [`acf_${key}`]: value,\r\n                            }),\r\n                            {}\r\n                          ),\r\n                      },\r\n                      \"\",\r\n                      true\r\n                    )}\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n    </div>\r\n  );\r\n};\r\n\r\n//固定ページ取得RestAPI関数\r\nexport const fetchPagesOptions = async (home_url) => {\r\n  const allPages = [];\r\n  let page = 1;\r\n\r\n  while (true) {\r\n    const items = await apiFetch({\r\n      path: addQueryArgs(\"/wp/v2/pages\", {\r\n        status: \"publish\", // 公開のみ\r\n        per_page: 100, // 最大100\r\n        page,\r\n        // orderby: \"title\",\r\n        // order: \"asc\",\r\n      }),\r\n    });\r\n\r\n    allPages.push(...items);\r\n\r\n    // 100件未満ならこれが最後\r\n    if (!items || items.length < 100) break;\r\n\r\n    page++;\r\n  }\r\n\r\n  // ページIDが-1である要素をホーム要素として作成\r\n  if (!allPages.some((p) => p.id === -1)) {\r\n    allPages.unshift({\r\n      id: -1,\r\n      title: { rendered: \"ホーム\" },\r\n      link: home_url,\r\n      slug: \"\",\r\n    });\r\n  }\r\n\r\n  const ret_pages = allPages.map((p) => ({\r\n    value: p.id,\r\n    slug: p.slug,\r\n    label: p.title?.rendered ?? \"\",\r\n    // 階層ページでも正しいURLになるようにRESTのlinkを優先\r\n    link: p.link || (p.slug ? `${home_url}/${p.slug}` : home_url),\r\n  }));\r\n\r\n  return ret_pages;\r\n};\r\n\r\n//アーカイブ情報取得RestAPI関数\r\nexport const fetchArchiveOptions = async (home_url) => {\r\n  const response = await apiFetch({ path: \"/wp/v2/types\" });\r\n\r\n  let idCounter = 0;\r\n  return Object.keys(response).reduce((acc, key) => {\r\n    const postType = response[key];\r\n    if (postType.has_archive === true) {\r\n      acc.push({\r\n        value: idCounter++,\r\n        slug: postType.slug,\r\n        rest_base: postType.rest_base,\r\n        link: `${home_url}/${postType.slug}`,\r\n        label: postType.name,\r\n      });\r\n    } else if (typeof postType.has_archive === \"string\") {\r\n      //アーカイブ名がついているとき\r\n      acc.push({\r\n        value: idCounter++,\r\n        slug: postType.slug,\r\n        rest_base: postType.rest_base,\r\n        link: `${home_url}/${postType.has_archive}`,\r\n        label: postType.name,\r\n      });\r\n    }\r\n    return acc;\r\n  }, []);\r\n};\r\n//投稿データ取得RestAPI関数\r\nexport const fetchPostOptions = async (home_url, props = {}) => {\r\n  const perPage = Math.min(Number(props.perPage || 100), 100);\r\n  const status = props.status || \"publish\"; // 管理画面で下書き等も含めたいなら 'any' を検討\r\n  const orderby = props.orderby || \"title\";\r\n  const order = props.order || \"asc\";\r\n  const search = props.search ? String(args.search) : \"\";\r\n  const restBase = props.restBase || \"\";\r\n\r\n  const allPosts = [];\r\n  const maxPagesSafety = 50; // 念のための安全上限\r\n\r\n  for (let page = 1; page <= maxPagesSafety; page++) {\r\n    const params = new URLSearchParams();\r\n    params.set(\"per_page\", String(perPage));\r\n    params.set(\"page\", String(page));\r\n    params.set(\"status\", status);\r\n    params.set(\"orderby\", orderby);\r\n    params.set(\"order\", order);\r\n    // 必要なフィールドだけ返して軽量化\r\n    params.set(\"_fields\", \"id,slug,title,link\");\r\n\r\n    if (search) params.set(\"search\", search);\r\n\r\n    const path = `/wp/v2/${encodeURIComponent(restBase)}?${params.toString()}`;\r\n\r\n    const posts = await apiFetch({ path });\r\n\r\n    if (!Array.isArray(posts) || posts.length === 0) break;\r\n\r\n    allPosts.push(...posts);\r\n\r\n    // これ以上ページがない（=最終ページ）と判断\r\n    if (posts.length < perPage) break;\r\n  }\r\n\r\n  // title.rendered はHTMLを含むことがあるのでタグを除去\r\n  const stripTags = (html) =>\r\n    String(html || \"\")\r\n      .replace(/<[^>]*>/g, \"\")\r\n      .trim();\r\n\r\n  return allPosts.map((post) => {\r\n    const title = stripTags(post?.title?.rendered) || \"(no title)\";\r\n\r\n    return {\r\n      value: Number(post.id), // ComboboxControl の value\r\n      label: title, // ComboboxControl の表示文字\r\n      slug: post.slug, // あなたの SelectControl が selectedSlug と照合するキー\r\n      link: post.link || `${home_url}/?p=${post.id}`,\r\n      rest_base: restBase,\r\n      post_id: Number(post.id),\r\n    };\r\n  });\r\n};\r\n\r\n//タクソノミー取得RestAPI関数\r\nexport const restTaxonomies = async (post_type) => {\r\n  if (!post_type) return;\r\n\r\n  const response = await apiFetch({\r\n    path: `/wp/v2/types/${post_type}?context=edit`,\r\n  });\r\n\r\n  const taxonomies = response.taxonomies;\r\n\r\n  const taxonomyPromises = taxonomies.map(async (slug) => {\r\n    const taxonomyResponse = await apiFetch({\r\n      path: `/wp/v2/taxonomies/${slug}?context=edit`,\r\n    });\r\n    const terms = await apiFetch({\r\n      path: `/wp/v2/${taxonomyResponse.rest_base}`,\r\n    });\r\n\r\n    return {\r\n      slug: slug,\r\n      name: taxonomyResponse.name,\r\n      rest_base: taxonomyResponse.rest_base,\r\n      terms: terms,\r\n    };\r\n  });\r\n\r\n  const taxonomyObjects = await Promise.all(taxonomyPromises);\r\n  return taxonomyObjects;\r\n};\r\n\r\n//タームの文字列化\r\nexport const termToDispObj = (terms, connectString) => {\r\n  // taxonomyごとにterm.nameをまとめる\r\n  const result = terms.reduce((acc, item) => {\r\n    const taxonomy = item.taxonomy;\r\n    const termName = item.term.name;\r\n\r\n    // taxonomyがまだ存在しない場合は初期化\r\n    if (!acc[taxonomy]) {\r\n      acc[taxonomy] = [];\r\n    }\r\n\r\n    // term.nameを配列に追加\r\n    acc[taxonomy].push(termName);\r\n\r\n    return acc;\r\n  }, {});\r\n\r\n  // 各taxonomyの配列を connectString でつなげて文字列化\r\n  for (const taxonomy in result) {\r\n    result[taxonomy] = result[taxonomy].join(connectString);\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n//フィールド情報取得RestAPI関数\r\nexport const restFieldes = async (rest_base) => {\r\n  //投稿データに以下のフィールドが含まれているかを調べる\r\n  const selectedFields = [\r\n    \"title\",\r\n    \"content\",\r\n    \"date\",\r\n    \"excerpt\",\r\n    \"featured_media\",\r\n    \"link\",\r\n    \"meta\",\r\n    \"acf\",\r\n  ];\r\n  const fieldsParam = selectedFields.join(\",\");\r\n  //最新の投稿データから１件分のデータを抽出\r\n  const response = await apiFetch({\r\n    path: `/wp/v2/${rest_base}?_fields=${fieldsParam}&per_page=1&order=desc`,\r\n  });\r\n\r\n  return response;\r\n};\r\n\r\nexport const PageSelectControl = (props) => (\r\n  <SelectControl {...props} fetchOptions={fetchPagesOptions} />\r\n);\r\n\r\nexport const ArchiveSelectControl = (props) => (\r\n  <SelectControl {...props} fetchOptions={fetchArchiveOptions} />\r\n);\r\n\r\nexport const PostSelectControl = (props) => (\r\n  <SelectControl {...props} fetchOptions={fetchPostOptions} />\r\n);\r\n\r\nexport const TermChoiceControl = (props) => (\r\n  <ChoiceControl {...props} fetchFunction={restTaxonomies} />\r\n);\r\n\r\nexport const FieldChoiceControl = (props) => (\r\n  <ChoiceControl {...props} fetchFunction={restFieldes} />\r\n);\r\n"],"names":["restFetchData","_ref","_asyncToGenerator","path","ret_data","apiFetch","error","console","message","_x","apply","arguments","SelectControl","props","selectedSlug","label","homeUrl","fetchOptions","options","setOptions","useState","useEffect","fetchData","_ref2","fetchedOptions","restBase","status","perPage","orderby","order","search","selectedInfo","find","info","slug","React","createElement","ComboboxControl","value","onChange","newValue","newInfo","ChoiceControl","choiceItems","dispTaxonomies","type","blockMap","textDomain","fetchFunction","choices","setChoices","_ref3","fetchChoices","pruneChoiceItemsByObjectKeys","handleChoiceChange","checked","target","setItems","some","item","_","isEqual","filter","buildComparableKeySet","dataObj","keySet","Set","key","val","Object","entries","Array","isArray","childKey","keys","add","concat","validKeys","getItemKey","_ref4","_ref5","_item$value","name","next","has","splice","length","dispCustumFields","obj","prefix","undefined","isImage","map","_ref6","fieldName","fieldLabel","replace","className","ToggleControl","choiceField","newChoiceFields","fieldKey","newBlockMap","_objectSpread","onBlockMapChange","choice","index","__","tax","onSetDispTax","terms","term","CheckboxControl","choiceTerm","taxonomy","id","newChoiceTerms","metaFlg","meta","every","acfFlg","acf","title","content","date","excerpt","featured_media","link","Fragment","reduce","acc","_ref7","_ref8","endsWith","_ref9","_ref0","_ref1","_ref10","fetchPagesOptions","_ref11","home_url","allPages","page","items","addQueryArgs","per_page","push","p","unshift","rendered","ret_pages","_p$title$rendered","_p$title","_x2","fetchArchiveOptions","_ref12","response","idCounter","postType","has_archive","rest_base","_x3","fetchPostOptions","_ref13","Math","min","Number","String","args","allPosts","maxPagesSafety","params","URLSearchParams","set","encodeURIComponent","toString","posts","stripTags","html","trim","post","_post$title","post_id","_x4","restTaxonomies","_ref14","post_type","taxonomies","taxonomyPromises","_ref15","taxonomyResponse","_x6","taxonomyObjects","Promise","all","_x5","termToDispObj","connectString","result","termName","join","restFieldes","_ref16","selectedFields","fieldsParam","_x7","PageSelectControl","_extends","ArchiveSelectControl","PostSelectControl","TermChoiceControl","FieldChoiceControl"],"mappings":"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"}