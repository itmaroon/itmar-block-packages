{"version":3,"file":"customFooks.js","sources":["../../src/customFooks.js"],"sourcesContent":["import { useRef, useEffect, useState } from \"@wordpress/element\";\r\nimport { useSelect, useDispatch } from \"@wordpress/data\";\r\nimport isEqual from \"lodash/isEqual\";\r\nimport { __ } from \"@wordpress/i18n\";\r\n\r\n//useRefで参照したDOM要素の大きさを取得するカスタムフック\r\nexport function useElementWidth() {\r\n  const ref = useRef(null);\r\n  const [width, setWidth] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const resizeObserver = new ResizeObserver((entries) => {\r\n      for (let entry of entries) {\r\n        setWidth(entry.contentRect.width);\r\n      }\r\n    });\r\n\r\n    if (ref.current) {\r\n      resizeObserver.observe(ref.current);\r\n    }\r\n\r\n    return () => {\r\n      resizeObserver.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  return [ref, width];\r\n}\r\n\r\n//ViewPortの大きさでモバイルを判断(767px以下がモバイル)するカスタムフック\r\nexport function useIsMobile() {\r\n  const [isMobile, setIsMobile] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (typeof window !== \"undefined\") {\r\n      const handleResize = () => {\r\n        setIsMobile(window.innerWidth <= 767);\r\n      };\r\n\r\n      window.addEventListener(\"resize\", handleResize);\r\n\r\n      return () => {\r\n        window.removeEventListener(\"resize\", handleResize);\r\n      };\r\n    }\r\n  }, []);\r\n\r\n  return isMobile;\r\n}\r\n\r\n//モバイル表示か否かを判定するフック\r\nexport function useIsIframeMobile() {\r\n  const [isMobile, setIsMobile] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // iframeのcontentWindowを監視する関数\r\n    const checkIframeSize = () => {\r\n      const iframeInstance = document.getElementsByName(\"editor-canvas\")[0];\r\n      if (iframeInstance && iframeInstance.contentWindow) {\r\n        setIsMobile(iframeInstance.contentWindow.innerWidth <= 767);\r\n      }\r\n    };\r\n\r\n    // iframeのcontentWindowのリサイズイベントにリスナーを追加\r\n    const iframeInstance = document.getElementsByName(\"editor-canvas\")[0];\r\n    if (iframeInstance && iframeInstance.contentWindow) {\r\n      iframeInstance.contentWindow.addEventListener(\"resize\", checkIframeSize);\r\n    }\r\n\r\n    // 初期チェックを実行\r\n    checkIframeSize();\r\n\r\n    // クリーンアップ関数\r\n    return () => {\r\n      if (iframeInstance && iframeInstance.contentWindow) {\r\n        iframeInstance.contentWindow.removeEventListener(\r\n          \"resize\",\r\n          checkIframeSize\r\n        );\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return isMobile;\r\n}\r\n\r\n//ブロックの背景色を取得するカスタムフック\r\nexport function useElementBackgroundColor(blockRef, style) {\r\n  const [baseColor, setBaseColor] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (blockRef.current && style) {\r\n      if (\r\n        style.backgroundColor &&\r\n        !style.backgroundColor.startsWith(\"var(--wp\")\r\n      ) {\r\n        //backgroundColorが設定されており、それがカスタムプロパティでない\r\n        setBaseColor(style.backgroundColor);\r\n      } else {\r\n        //レンダリング結果から背景色を取得\r\n        if (blockRef.current) {\r\n          const computedStyles = getComputedStyle(blockRef.current);\r\n          setBaseColor(computedStyles.backgroundColor);\r\n        }\r\n      }\r\n    }\r\n  }, [style, blockRef]);\r\n\r\n  return baseColor;\r\n}\r\n\r\n//ブロックのスタイルを取得し、コールバック関数を返すカスタムフック\r\nexport function useElementStyleObject(blockRef, style) {\r\n  const [styleObject, setStyleObject] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (blockRef.current && style) {\r\n      //レンダリング結果に基づくスタイルの取得\r\n      const computedStyles = getComputedStyle(blockRef.current);\r\n      // styleオブジェクトのキーに基づいてnewStyleObjectを生成\r\n      const newStyleObject = Object.keys(style).reduce((acc, key) => {\r\n        if (computedStyles[key]) {\r\n          // computedStylesにキーが存在するか確認\r\n          acc[key] = computedStyles[key];\r\n        }\r\n        return acc;\r\n      }, {});\r\n\r\n      setStyleObject(JSON.stringify(newStyleObject));\r\n    }\r\n  }, [blockRef, style]);\r\n  // styleObjectをオブジェクトとして返す\r\n  return styleObject;\r\n}\r\n\r\n//たくさんの要素をもつオブジェクトや配列の内容の変化で発火するuseEffect\r\nexport function useDeepCompareEffect(callback, dependencies) {\r\n  const dependenciesRef = useRef();\r\n\r\n  if (!isEqual(dependencies, dependenciesRef.current)) {\r\n    dependenciesRef.current = dependencies;\r\n  }\r\n\r\n  useEffect(() => {\r\n    return callback();\r\n  }, [dependenciesRef.current]);\r\n}\r\n\r\nexport function useFontawesomeIframe() {\r\n  //iframeにfontawesomeを読み込む\r\n  useEffect(() => {\r\n    const iframeInstance = document.getElementsByName(\"editor-canvas\")[0];\r\n\r\n    if (iframeInstance) {\r\n      const iframeDocument =\r\n        iframeInstance.contentDocument || iframeInstance.contentWindow.document;\r\n      const scriptElement = iframeDocument.createElement(\"script\");\r\n      scriptElement.setAttribute(\"src\", \"../../../assets/fontawesome.js\");\r\n      //scriptElement.setAttribute(\"crossorigin\", \"anonymous\");\r\n\r\n      iframeDocument.body.appendChild(scriptElement);\r\n\r\n      // Return a cleanup function to remove the script tag\r\n      return () => {\r\n        iframeDocument.body?.removeChild(scriptElement);\r\n      };\r\n    }\r\n  }, []);\r\n}\r\n\r\n//ネストしたブロックを平坦化\r\nconst getFlattenBlocks = (blocks) => {\r\n  return blocks.reduce((acc, block) => {\r\n    acc.push(block);\r\n    if (block.innerBlocks && block.innerBlocks.length > 0) {\r\n      acc.push(...getFlattenBlocks(block.innerBlocks));\r\n    }\r\n    return acc;\r\n  }, []);\r\n};\r\n\r\n//指定されたブロック名とクラス名を含むブロックの属性が更新されたときその更新内容をかえすフック\r\nexport function useBlockAttributeChanges(\r\n  clientId,\r\n  blockName,\r\n  className,\r\n  modFlg = false,\r\n  excludeAttributes = {}\r\n) {\r\n  const [latestAttributes, setLatestAttributes] = useState(null);\r\n  //const [idleFlg, setIdleFlg] = useState(null);\r\n  const prevBlocksRef = useRef({});\r\n\r\n  //属性変更関数を取得\r\n  const { updateBlockAttributes } = useDispatch(\"core/block-editor\");\r\n  //インナーブロックを平坦化する関数\r\n  const flattenedBlocks = useSelect(\r\n    (select) => {\r\n      const { getBlock } = select(\"core/block-editor\");\r\n      const rootBlock = getBlock(clientId);\r\n      return rootBlock ? getFlattenBlocks([rootBlock]) : [];\r\n    },\r\n    [clientId]\r\n  );\r\n\r\n  const targetBlocks = flattenedBlocks.filter(\r\n    (block) =>\r\n      block.name === blockName &&\r\n      block.attributes.className?.includes(className)\r\n  );\r\n\r\n  useEffect(() => {\r\n    //平坦化されたブロックを調査\r\n    for (const block of targetBlocks) {\r\n      const prevAttributes =\r\n        prevBlocksRef.current[block.clientId]?.attributes || {};\r\n      //既に先に記録された属性があることをチェック\r\n      if (Object.keys(prevAttributes).length > 0) {\r\n        // 除外する属性を取り除いた属性オブジェクトを作成\r\n        const filteredCurrentAttributes = Object.keys(block.attributes).reduce(\r\n          (acc, key) => {\r\n            if (!excludeAttributes.hasOwnProperty(key)) {\r\n              acc[key] = block.attributes[key];\r\n            }\r\n            return acc;\r\n          },\r\n          {}\r\n        );\r\n\r\n        const filteredPrevAttributes = Object.keys(prevAttributes).reduce(\r\n          (acc, key) => {\r\n            if (!excludeAttributes.hasOwnProperty(key)) {\r\n              acc[key] = prevAttributes[key];\r\n            }\r\n            return acc;\r\n          },\r\n          {}\r\n        );\r\n\r\n        //属性の変化を比較\r\n        if (\r\n          JSON.stringify(filteredCurrentAttributes) !==\r\n          JSON.stringify(filteredPrevAttributes)\r\n        ) {\r\n          //確認ダイアログが出ている状態か否かで状態変数を変化させる\r\n          // if (block.attributes.isIdle) {\r\n          //   setIdleFlg(true);\r\n          // } else {\r\n          //   setIdleFlg(false);\r\n          // }\r\n          //呼び出し元に返すための更新後の属性オブジェクトを格納\r\n\r\n          setLatestAttributes(JSON.stringify(filteredCurrentAttributes));\r\n        }\r\n      }\r\n      // 現在のブロック状態を保存（除外属性も含めて保存）\r\n      prevBlocksRef.current[block.clientId] = { ...block };\r\n    }\r\n  }, [targetBlocks, blockName, className]);\r\n\r\n  //innerFlattenedBlocks内の同一種のブロックに対して属性をセットする;\r\n  useEffect(() => {\r\n    //確認ダイアログが処理されたことを確認してからこちらの処理を進める\r\n    if (latestAttributes && modFlg) {\r\n      // const latestAttrObj = JSON.parse(latestAttributes);\r\n      // const setObj = {\r\n      //   ...latestAttrObj,\r\n      //   className: `auto_attr_change ${latestAttrObj.className}`,\r\n      // };\r\n      targetBlocks.forEach((block) => {\r\n        updateBlockAttributes(block.clientId, JSON.parse(latestAttributes));\r\n      });\r\n    }\r\n  }, [latestAttributes]);\r\n\r\n  return JSON.parse(latestAttributes);\r\n}\r\n\r\n//インナーブロックが挿入されたとき、指定されたブロック名が存在れば、挿入されたブロックを削除するフック\r\nexport function useDuplicateBlockRemove(clientId, blockNames) {\r\n  const { removeBlock } = useDispatch(\"core/block-editor\");\r\n  const { createNotice } = useDispatch(\"core/notices\");\r\n\r\n  // clientIdに対応するインナーブロックを取得\r\n  const innerBlocks = useSelect(\r\n    (select) => select(\"core/block-editor\").getBlocks(clientId),\r\n    [clientId]\r\n  );\r\n\r\n  // 前回の innerBlocks を保存するための ref\r\n  const prevInnerBlocksRef = useRef(innerBlocks);\r\n\r\n  useEffect(() => {\r\n    const prevInnerBlocks = prevInnerBlocksRef.current;\r\n    //先に保存したインナーブロックの中に対象となるブロックが存在しなければ何もしない\r\n    const result = prevInnerBlocks.some((block) =>\r\n      blockNames.includes(block.name)\r\n    );\r\n\r\n    if (result) {\r\n      // ブロックが挿入されているか確認（前回と比較）\r\n      if (innerBlocks.length > prevInnerBlocks.length) {\r\n        // 新しく挿入されたブロックを特定\r\n        const newlyInsertedBlock = innerBlocks.find(\r\n          (block) =>\r\n            !prevInnerBlocks.some(\r\n              (prevBlock) => prevBlock.clientId === block.clientId\r\n            )\r\n        );\r\n\r\n        // 新しいブロックが blockNames に含まれている場合、削除\r\n        if (\r\n          newlyInsertedBlock &&\r\n          blockNames.includes(newlyInsertedBlock.name)\r\n        ) {\r\n          removeBlock(newlyInsertedBlock.clientId);\r\n\r\n          // 通知を作成\r\n          createNotice(\r\n            \"error\", // 通知のタイプ（エラー）\r\n            __(\r\n              \"A new block cannot be inserted because a block has already been placed.\",\r\n              \"block-collections\"\r\n            ), // メッセージ\r\n            {\r\n              type: \"snackbar\", // 通知のスタイル\r\n              isDismissible: true, // 通知を閉じることができるか\r\n            }\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    // 現在の innerBlocks を次回用に保存\r\n    prevInnerBlocksRef.current = innerBlocks;\r\n  }, [innerBlocks, blockNames, removeBlock, createNotice]);\r\n}\r\n"],"names":["useElementWidth","ref","useRef","width","setWidth","useState","useEffect","resizeObserver","ResizeObserver","entries","entry","contentRect","current","observe","disconnect","useIsMobile","isMobile","setIsMobile","window","handleResize","innerWidth","addEventListener","removeEventListener","useIsIframeMobile","checkIframeSize","iframeInstance","document","getElementsByName","contentWindow","useElementBackgroundColor","blockRef","style","baseColor","setBaseColor","backgroundColor","startsWith","computedStyles","getComputedStyle","useElementStyleObject","styleObject","setStyleObject","newStyleObject","Object","keys","reduce","acc","key","JSON","stringify","useDeepCompareEffect","callback","dependencies","dependenciesRef","isEqual","useFontawesomeIframe","iframeDocument","contentDocument","scriptElement","createElement","setAttribute","body","appendChild","_iframeDocument$body","removeChild","getFlattenBlocks","blocks","block","push","innerBlocks","length","useBlockAttributeChanges","clientId","blockName","className","modFlg","arguments","undefined","excludeAttributes","latestAttributes","setLatestAttributes","prevBlocksRef","updateBlockAttributes","useDispatch","flattenedBlocks","useSelect","select","getBlock","rootBlock","targetBlocks","filter","_block$attributes$cla","name","attributes","includes","_loop","_prevBlocksRef$curren","prevAttributes","filteredCurrentAttributes","hasOwnProperty","filteredPrevAttributes","_objectSpread","forEach","parse","useDuplicateBlockRemove","blockNames","removeBlock","createNotice","getBlocks","prevInnerBlocksRef","prevInnerBlocks","result","some","newlyInsertedBlock","find","prevBlock","__","type","isDismissible"],"mappings":"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"}